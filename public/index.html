<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="Description" content="this is an awesome car pool app"/>
    <title>CarPool</title>
    <meta name="viewport" content="width=device-width"/>
    <link href="/ratchet/css/ratchet.min.css" rel="stylesheet">
    <script src="/ratchet/js/ratchet.min.js" async></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-app.js" async></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-messaging.js" async></script>
    <link rel="manifest" href="manifest.json"/> 
    <script>
    if('serviceWorker' in navigator) {
      window.addEventListener('load' , function() {
        navigator.serviceWorker.register('/serviceworker.js')
        .then(function(registration) {
          console.log('registation successful, scope is ', registration.scope)
          registration.onupdatefound = function() {
            var installingWorker = registration.installing;
            installingWorker.onstatechange= function(){
              if(installingWorker.state ==='installed'){
                if(navigator.serviceWorker.controller){
                  document.getElementById('new-version-alert').style="";
                  console.log('new content available');
                } else{
                  //
                }
              }
            }
          }
          firebase.initializeApp({
            "apiKey": "AIzaSyAtcsQKYqEoFQE35gsrLf7C7I8bczJaufI",
            "authDomain": "carpoolapptest.firebaseapp.com",
            "databaseURL": "https://carpoolapptest.firebaseio.com",
            "projectId": "carpoolapptest",
            "storageBucket": "carpoolapptest.appspot.com",
            "messagingSenderId": "143803579783"
            });
          const messaging = firebase.messaging();
          messaging.useServiceWorker(registration);
          messaging.requestPermission()
          .then(() => messaging.getToken())
          .then(token => {
            console.log('token :', token);
            return fetch('/registerToken', {
                            method: 'POST', 
                            headers: {
                              'Content-type': 'application/json'
                            },
                            body: JSON.stringify({token}),
                        });
                    })
        }).catch(function(error){
          console.log('an error occurred while service worker registration', error)
        })
      })
    }
    </script>
  </head>
  <body>
  <noscript>
      <div>
          <p>
              L'activation de JavaScript est n√©cessaire pour que l'application fonctionne
          </p>
      </div>
  </noscript>
    <div id="app"></div>
    <script type="text/javascript" src="/javascripts/bundle/carpool.js"></script>
  </body>
</html>
